{% extends 'lab_base.html' %}

{% block body %}

<!-- Style Guide Modal -->
<div class="modal fade" id="styleGuide" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Style Guide</h4>
      </div>
      	<div class="modal-body">
      		<p>No content yet. But drunk yoga seems like fun...</p>
      		<img src="http://media.giphy.com/media/W7o9UzkwWpA0o/giphy.gif"/></div>
  	</div>
</div>
</div>

<!-- Size Guide Modal -->
<div class="modal fade" id="sizeGuide" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Sizing Help</h4>
      </div>
      	<div class="modal-body">
      		<form class="form-group" action='/suggestions' method="post">
	      		<p> Tell us about your body shape and measurements and we'll make sure your pants fit just right. </p>
	      		<textarea rows="10" cols="50" name="size-suggestions" id="size-suggestions" placeholder="Sizing suggestions...."></textarea>
	      		<br>
	      		<input type="submit" class="btn-editorial submit" value="Save my suggestions">
      		</form>
      		<div class="modal-footer">
        		<button type="button" class="btn-modal" data-dismiss="modal">Close</button>
      		</div>
      	</div>
  	</div>
</div>
</div>
<!-- Main content starts here -->


<!-- Form starts here -->
<form action='/step2' method="post" id="step1-form">	
	<div class="row">
		<div class="col-md-1">
		</div>
		<div class="col-md-3 form-group">
			<div class="well">
				<p class="section"> Style </p>
				<ul class="list-group styles">
					{% for style in styles %}
					<li class="list-group-item"> <input type="radio" name="style" class="style-button" value="{{style.style_id}}" data-validate="required"> {{style.style_name}}</li>
					{% endfor %}
				</ul>
				<!-- Button to launch style guide modal window -->
				<button class="btn-modal" type="button" data-toggle="modal" data-target="#styleGuide" id="style-guide"> Style Guide </button> 
			</div>

			<div class="well">
				<p class="section">Size </p>
				<select class="size"name="size"> 	
					{% for size in sizes %}
					<option class="size" value="{{size.size_code}}">{{size.size}}</option>
					{% endfor %}
				</select>
				<br>
				<br>
				<!-- Button to launch sizing help window -->
				<button class="btn-modal" type="button" data-toggle="modal" data-target="#sizeGuide" id="size-guide"> I don't know my size</button>
			</div>
		</div>
	

		<div class="col-md-4 col-md-offset-1" id="design-div">
		<!-- this is the base image -->
		<object class="doll" id="design-object" data="/static/svg/{{session['current_design']['style_svg']}}" alt="blank model"></object> 
		</div>

		<div class="col-md-2">
			<div class="well" id="slider">
				<p class="section" >Waist height </p>
				<br>
				<p class="label">High-Waist</p><input class="bar" name="waist" id="waist" orient="vertical" type="range" min="1" max="2" step="1" value="{{session['current_design']['waist_id']}}"> <p class="label">Low-waist</p>
			</div>
	
			<div>
				<input type="hidden" name="style-svg" id="style-svg">
				<input class="btn-editorial submit" type="submit" href="/step2" value ="Next step please!">
			</div>
		</div>
	</div>
</form>


<!-- Javascript and JQuery!!!! -->
<script src="https://code.jquery.com/jquery.js"></script>
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/latest/js/bootstrap.js"></script>
<script> 

////////DEFINE VARIABLES/////
var index;
var style_data;
var svg_path;


///////DEFINE FUNCTIONS////////
var change_svg = function (style_data, index) {
	svg_path = style_data[index].style_svg;
	console.log("This is the svg_path:")
	console.log(svg_path);
	$('#design-object').attr('data', '/static/svg/'+svg_path); //changes the src of the img 
	$('#style-svg').attr('value', svg_path);
	console.log($('#style-svg').val()); //svg path can be added to session
	$('.styles').removeClass('nope');
};

var change_radio = function(style_data, index){
	id = style_data[index].style_id;
	console.log(id);
	selector_str = '.style-button[value="'+id+'"]';
	console.log(selector_str);
	$(selector_str).prop("checked", true);
};

var change_waist = function(){

	var waist = $('#waist').val();
	
	var obj = document.getElementById("design-object");
	var objData = obj.contentDocument;
	var highWaist = objData.getElementById("highWaist");
	var lowWaist = objData.getElementById("lowWaist");
	console.log(waist);


	if (waist == 1) {
		highWaist.setAttribute('visibility', 'hidden');
		console.log(highWaist);
		lowWaist.setAttribute('visibility', 'visible');
		console.log(lowWaist);
	} else {
		highWaist.setAttribute('visibility', 'visible');
		console.log(highWaist);
		lowWaist.setAttribute('visibility', 'hidden');
		console.log(lowWaist);
	};
};


$(document).ready(function(){
    console.log("ready!");
    ////////GET DATA FROM SERVER////////
	$.get('/styles.json', function(data){
				console.log(data.styles);
				style_data = data.styles;
				index = -1;
				setUpPage();
				change_waist();
	});

	$('#styles-tab').addClass('selected');

});
		

		///////EVENT HANDLERS////////

	// // click the image to change the style 
	console.log(index);
	var obj = document.getElementById("design-object");
	console.log(obj);
	obj.addEventListener('load', function(){
		var obj = document.getElementById("design-object");
		var objData = obj.contentDocument;

		var el = objData.getElementById("doll");
		console.log(el);
		el.addEventListener("click", function(evt){

			console.log("clicked!");
			console.log(evt);
			index++;
			if (index === style_data.length) {
				index = 0;
			}
			console.log(index);
			change_svg(style_data, index);
			change_radio(style_data, index);
			$('input[name=waist').val('2');
			});
	});

var setUpPage = function(){
	console.log("Page is set up now!");

	var styleButtons = $('.style-button'); 

	// click the button to change the style
	$(styleButtons).each( function(idx) {
		$(this).on('click', function(evt) {
			index = $(this).val() - 1;
			console.log("INDEX");
			console.log(index);
			$('input[name=waist').val('2');
			change_svg(style_data, index);
		});	
	});
			 
	// change the slider bar to select waist style
	$('#waist').click( function(evt){
		console.log(evt);
		change_waist();
	});

	// Form validation 
	$('#step1-form').on('submit', function(evt){
		var styleSelected = $("input[name='style']:checked").length;
		console.log(styleSelected);
		if(styleSelected == 0) {
		   //Is not Valid
		   evt.preventDefault();
		   $('.styles').addClass('nope');
		   console.log(evt);
		}
	});
		
};





</script>

{% endblock %}
